<html>
<head>
<title>Togetherness Table</title>
<meta charset="utf-8">

<!--
 The SVG viewport is the scrolling / panning / zooming area, so
 prevent touch events from zooming into the page
 ( from https://www.html5rocks.com/en/mobile/touchandmouse/ )
-->
<meta name="viewport" content="width=device-width,user-scalable=no">

<script src="./svg_draggable.js"></script>
<script src="./base32.js"></script>
<script src="./svg.js"></script>
<script src="./index.js"></script>
<script src="./js/domJSON.js"></script>

<link rel="stylesheet" type="text/css" href="animate.css">
<link rel="stylesheet" type="text/css" href="index.css">
<link rel="stylesheet" type="text/css"
  href="https://fontlibrary.org/face/subotype"
  media="screen"
/>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>

<style type="text/css" />
@font-face {
  font-family: SubotypeSteady;
  src: url("subotype_steady.otf") format("opentype");
}
</style>


</head>

<script>
var svg_table;
var viewport;
var gViewport;

function initSvgTable(el) {
  el.id = 'svg_table'
  svg_table = SVG.adopt(el)
  svg_table.size(1000, 480)
  gViewport.add(svg_table)
  makeDraggable(SVG.adopt(byId('svg_viewport')), svg_table)
  return svg_table
}

SVG.on(document, 'DOMContentLoaded', () => {
  // Override the id-generating function of the svg.js library
  SVG.eid = (name) => {
    return name + '_' + base32.short_id()
  }

  viewport = SVG('gamearea').size(500, 480)
  viewport.node.id = 'svg_viewport'
  s(viewport.node, 'width', viewport.node.parentNode.clientWidth)
  viewport.style('background-image', 'url(svg/bg_hexagons.svg)')
  viewport.node.addEventListener('svg_dragsafe_click', (e) => {
    console.log("-0--------------------------", e.detail.elemId, viewport.node.id)
    if (e.detail.elemId === viewport.node.id) {
      ui.unmark_all_but()
    }
  })

  gViewport = SVG.adopt(document.createElementNS(SVG.ns, 'g'))
  gViewport.node.id = 'g_viewport'
  viewport.add(gViewport)

  table_rect = gViewport.rect()
  table_rect.attr({
     x: -1,
     y: -1,
     rx: 0,
     ry: 0,
     width: 1002,
     height: 482,
     fill: 'none',
     stroke: 'black',
     'stroke-width': 10,
     'stroke-opacity': 0.2,
  })

  svg_table = initSvgTable(document.createElementNS(SVG.ns, 'svg'))
  //#makeDraggable(viewport, svg_table)

  document.addEventListener('svg_dragend', (evt) => {
    selectedElement = byId(evt.detail.elemId)
  })

})

function updateColorSample(target) {
  el = target.parentNode.querySelector('#colorsample')
  el.style.setProperty('border', 'solid thin black')
  el.style.setProperty('color', target.value)
}

function downKey(e) {
  if (e.target.tagName.toLowerCase() !== 'body') { return }
  if (e.altKey || e.shiftKey || e.metaKey || e.ctrlKey) { return }
  button = null
  document.querySelectorAll('button').forEach((x) => {
    if (button && x.accessKey === e.key) {
      console.error('Two buttons have the same accessKey', x.accessKey)
      return
    }
    if (x.accessKey === e.key) {
      button = x
    }
  })
  if (button) {
    button.click()
  }
}

window.addEventListener('load', () => {
  document.querySelector('body').addEventListener('keydown', downKey)
})

</script>

<body>

<!-- ==================================================================== -->
<!-- ==================================================================== -->
<style>
#gamearea {
  max-width: 800px;
}
</style>
<center>
  <div id="gamearea" contextmenu="gamemenu">
  <!--
  <svg id="svgdoc" width="100%" height="500" onload="initDraggable()">
  </svg>
  -->
  <svg width="0" height="0">
  </svg>
  </div>
</center>
<!-- ==================================================================== -->
<!-- ==================================================================== -->


</body>
</html>

